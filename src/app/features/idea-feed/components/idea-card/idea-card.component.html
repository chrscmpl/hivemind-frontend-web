@let ageString =
  idea.age ? (idea.age | humanizeDuration: "short" : 1 : "") : "";
@let isMobile = breakpoints.isMobile();

<div
  tuiCardLarge
  class="!bg-background-base hover:!bg-background-base-alt active:!bg-background-neutral-1-hover transition-colors duration-300 hover:cursor-pointer"
  [class.!rounded-none]="isMobile"
>
  <section
    tuiHeader
    class="grid grid-cols-[auto_auto_auto_1fr] items-center content-center gap-x-2 text-text-tertiary"
  >
    @if (idea.user?.handle && idea.user?.displayName) {
      <span
        tuiAppearance="flat-grayscale"
        class="!text-text-secondary line-clamp-1 break-all"
      >
        <span class="text-text-secondary"> {{ idea.user!.displayName }}</span>
        &nbsp; &commat;{{ idea.user!.handle }}
      </span>
      <span>â€¢</span>
    }
    <span class="flex items-center">
      {{ ageString }}
      @if (idea.updated) {
        <tui-icon
          icon="@tui.pencil"
          [tuiHint]="'Updated ' + (idea.updatedAt | date: 'medium')"
          tuiHintAppearance=""
          [tuiHintDirection]="isMobile ? 'top-left' : 'right'"
          class="h-4 text-text-tertiary"
        />
      }
    </span>
    <button
      appearance="outline-grayscale"
      iconStart="@tui.ellipsis-vertical"
      tuiDropdownHover
      tuiIconButton
      type="button"
      [tuiDropdown]="dropdown"
      size="s"
      appearance="flat-grayscale"
      class="!rounded-full justify-self-end col-start-[-1]"
    >
      More
    </button>
  </section>

  <section>
    <h2 tuiTitle class="text-2xl">{{ idea.title }}</h2>
  </section>

  <section
    tuiAppearance="flat-grayscale"
    [innerHTML]="idea.content"
    class="line-clamp-2 break-words"
  ></section>

  <section class="flex items-center gap-2">
    <div class="flex">
      <button
        tuiButton
        appearance="outline-grayscale"
        class="!bg-background-base !flex !items-center !w-min !rounded-s-full !px-2 !gap-0 !h-10 !cursor-default"
      >
        <input
          tuiLike
          [formControl]="upvoteControl"
          type="checkbox"
          checkedIcon="@tui.arrow-big-up"
          uncheckedIcon="@tui.arrow-big-up"
          class="!border-4 !h-8 !w-8 !bg-transparent after:!text-upvote"
          appearance="neutral"
        />
        @if (
          idea.upvoteCount !== undefined &&
          idea.downvoteCount !== undefined &&
          idea.upvoteCount !== null &&
          idea.downvoteCount !== null
        ) {
          <span>{{
            idea.upvoteCount - idea.downvoteCount | average | uppercase
          }}</span>
        }
      </button>
      <button
        tuiButton
        appearance="outline-grayscale"
        class="!bg-background-base !flex !items-center !rounded-e-full !border-l-0 !h-10 !px-2 !cursor-default"
      >
        <input
          tuiLike
          [formControl]="downvoteControl"
          type="checkbox"
          checkedIcon="@tui.arrow-big-down"
          uncheckedIcon="@tui.arrow-big-down"
          class="!border-4 !h-8 !w-8 !bg-transparent after:!text-downvote"
          appearance="neutral"
        />
      </button>
    </div>

    <button
      tuiButton
      appearance="outline-grayscale"
      class="!bg-background-base !rounded-full !flex !items-center !w-min !h-10 !gap-3 !px-4"
    >
      <tui-icon
        icon="@tui.message-square-text"
        tuiAppearance="neutral"
        class="!bg-transparent"
      />
      {{ idea.commentCount }}
    </button>
  </section>
</div>

<ng-template #dropdown>
  <tui-data-list size="s">
    <button iconStart="@tui.share-2" tuiOption (click)="share()">Share</button>
    @if (isAuthor) {
      <button iconStart="@tui.pencil" tuiOption>Edit</button>
      <button iconStart="@tui.trash" tuiOption>Delete</button>
    }
  </tui-data-list>
</ng-template>
